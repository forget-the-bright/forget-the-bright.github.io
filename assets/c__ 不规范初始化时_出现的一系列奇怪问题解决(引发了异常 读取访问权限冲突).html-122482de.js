import{_ as p,W as o,X as e,Z as n,$ as s,a0 as t,a2 as c,C as l}from"./framework-3a0c4e99.js";const i={},u=c(`<h1 id="c-不规范初始化时-出现的一系列奇怪问题解决-引发了异常-读取访问权限冲突" tabindex="-1"><a class="header-anchor" href="#c-不规范初始化时-出现的一系列奇怪问题解决-引发了异常-读取访问权限冲突" aria-hidden="true">#</a> c++ 不规范初始化时,出现的一系列奇怪问题解决(引发了异常 读取访问权限冲突)</h1><p><strong>今天公司的c++ 项目，需要加一下小功能，读取配置，控制业务功能开启</strong></p><h4 id="问题原因" tabindex="-1"><a class="header-anchor" href="#问题原因" aria-hidden="true">#</a> 问题原因</h4><p>这是有一段main 方法内的代码块 nacos 初始化并注册的代码</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code>    nacos<span class="token double-colon punctuation">::</span>Nacos <span class="token function">nacos</span><span class="token punctuation">(</span><span class="token function">GetIpAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PORT<span class="token punctuation">,</span> NACOS_APPNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    nacos<span class="token punctuation">.</span>namespaceId <span class="token operator">=</span> NACOS_NAMESPACEID<span class="token punctuation">;</span>
    nacos<span class="token double-colon punctuation">::</span>NacosClient <span class="token function">cli</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>nacos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cli<span class="token punctuation">.</span><span class="token function">registerNacos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是如果加上if 之后 或者代码提出来到外部方法内 就会出现问题了</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
    nacos<span class="token double-colon punctuation">::</span>Nacos <span class="token function">nacos</span><span class="token punctuation">(</span><span class="token function">GetIpAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PORT<span class="token punctuation">,</span> NACOS_APPNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    nacos<span class="token punctuation">.</span>namespaceId <span class="token operator">=</span> NACOS_NAMESPACEID<span class="token punctuation">;</span>
    nacos<span class="token double-colon punctuation">::</span>NacosClient <span class="token function">cli</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>nacos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cli<span class="token punctuation">.</span><span class="token function">registerNacos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
或
<span class="token keyword">void</span>  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    nacos<span class="token double-colon punctuation">::</span>Nacos <span class="token function">nacos</span><span class="token punctuation">(</span><span class="token function">GetIpAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PORT<span class="token punctuation">,</span> NACOS_APPNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    nacos<span class="token punctuation">.</span>namespaceId <span class="token operator">=</span> NACOS_NAMESPACEID<span class="token punctuation">;</span>
    nacos<span class="token double-colon punctuation">::</span>NacosClient <span class="token function">cli</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>nacos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cli<span class="token punctuation">.</span><span class="token function">registerNacos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>就会出现 引发了异常: <strong>读取访问权限冲突 问题</strong> 图片就不粘贴了 这里开了个线程跑了个方法监听发送心跳检测</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code> <span class="token keyword">void</span> nacos<span class="token double-colon punctuation">::</span><span class="token class-name">NacosClient</span><span class="token double-colon punctuation">::</span><span class="token function">beatNacos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>beatNacosThread<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> action<span class="token double-colon punctuation">::</span>BeatNacosThread<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">BeatNacosThread</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			NacosClient<span class="token operator">&amp;</span> cli <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>NacosClient<span class="token operator">*</span><span class="token punctuation">)</span>args<span class="token punctuation">;</span>
			Nacos <span class="token operator">*</span>nacos <span class="token operator">=</span> cli<span class="token punctuation">.</span><span class="token function">getNacos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>就在这一段出现的问题 BeatNacosThread 方法的 参数 传递的是NacosClient 指针，但是指针指向的堆空间损坏了。方法内读取参数就会出现（读取访问权限冲突问题）</p><h4 id="问题解决" tabindex="-1"><a class="header-anchor" href="#问题解决" aria-hidden="true">#</a> 问题解决</h4><p>其实也很简单: 使用new 实例化</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code> nacos<span class="token double-colon punctuation">::</span>Nacos <span class="token operator">*</span>nacos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Nacos</span><span class="token punctuation">(</span>LOCAL_IP<span class="token punctuation">,</span> PORT<span class="token punctuation">,</span> NACOS_APPNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
		 nacos<span class="token operator">-&gt;</span>namespaceId <span class="token operator">=</span> NACOS_NAMESPACEID<span class="token punctuation">;</span>
		 nacos<span class="token double-colon punctuation">::</span>NacosClient <span class="token operator">*</span>cli <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">NacosClient</span><span class="token punctuation">(</span>nacos<span class="token punctuation">)</span><span class="token punctuation">;</span>
		 cli<span class="token operator">-&gt;</span><span class="token function">registerNacos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 cli<span class="token operator">-&gt;</span><span class="token function">getNacosConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 cli<span class="token operator">-&gt;</span><span class="token function">listenNacosConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="问题总结" tabindex="-1"><a class="header-anchor" href="#问题总结" aria-hidden="true">#</a> 问题总结</h4><p>默认的实例化方式是其实调用的<strong>c 的 malloc 函数</strong> malloc 函数实例化的对象堆的内存空间是动态的，如果方法执行完成 或者 在if 语句块也是同样的原理，方法内的对象 或 if 语句块中的对象 内存就会损坏， 但是如果用 new 的话 创建的对象堆内存不是动态的。方法执行完毕也不会损坏。清理空间方法是使用 delete 关键字。</p>`,15),r={href:"https://blog.csdn.net/fb_941219/article/details/106968262?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-106968262-blog-104897719.pc_relevant_default&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-106968262-blog-104897719.pc_relevant_default&utm_relevant_index=1",target:"_blank",rel:"noopener noreferrer"},k={href:"https://blog.csdn.net/weixin_44120025/article/details/115279323",target:"_blank",rel:"noopener noreferrer"},d={href:"https://blog.csdn.net/qq_34272143/article/details/122594250",target:"_blank",rel:"noopener noreferrer"},_={href:"https://www.cnblogs.com/MYJ55/p/6765587.html",target:"_blank",rel:"noopener noreferrer"};function v(m,b){const a=l("ExternalLinkIcon");return o(),e("div",null,[u,n("p",null,[s("参考资料 "),n("a",r,[s("读取字符串的字符时出错 无法读取内存"),t(a)]),n("a",k,[s("vs debug模式下显示“变量已被优化掉，因而不可用”的解决办法"),t(a)]),n("a",d,[s("C中的malloc和free释放原理"),t(a)]),n("a",_,[s("c++调试出现“读取字符串的字符时出错”，无法读取内存? 以及malloc函数和new 的区别"),t(a)])])])}const h=p(i,[["render",v],["__file","c__ 不规范初始化时_出现的一系列奇怪问题解决(引发了异常 读取访问权限冲突).html.vue"]]);export{h as default};
